credentials:
  postgresPassword: foundry

nfs-server-provisioner:
  persistence:
    enabled: true

ingress-nginx:
  controller:
    config:
      hsts: "false"
      annotations-risk-level: critical
    allowSnippetAnnotations: true
    ingressClassResource:
      default: true
    updateStrategy:
      type: RollingUpdate
  tcp:
    2049: "foundry/nfs-server-provisioner:2049"
    #5432: "foundry/postgresql:5432"

postgresql:
  auth:
    existingSecret: foundry-secret
  primary:
    persistence:
      size: 1Gi
    initdb:
      scripts:
        create-dbs.sql: |
          CREATE DATABASE keycloak;
          CREATE DATABASE gitea;

pgadmin4:
  serverDefinitions:
    servers:
        foundry:
          Name: "foundry"
          Group: "Servers"
          Port: 5432
          Username: "postgres"
          Host: "postgresql"
          PassFile: "../../pgpass.conf"
          SSLMode: "prefer"
          MaintenanceDB: "postgres"
  ingress:
    enabled: true
    annotations:
      nginx.ingress.kubernetes.io/configuration-snippet: |
        proxy_set_header X-Script-Name /pgadmin;
    hosts:
      - host: foundry.local
        paths:
          - path: /pgadmin
            pathType: Prefix
    tls:
      - secretName: appliance-cert
        hosts:
          - foundry.local
  extraSecretMounts:
    - name: pgpassfile
      secret: pgpassfile
      subPath: pgpassfile
      mountPath: "/pgpass.conf"
      readOnly: true
  env:
    email: administrator@foundry.local
    password: foundry
    variables:
      - name: PGADMIN_DISABLE_POSTFIX
        value: "true"
      - name: PGADMIN_CONFIG_ALLOW_SPECIAL_EMAIL_DOMAINS
        value: "['local']"
  persistentVolume:
    size: 1Gi
  extraInitContainers: |
    - name: add-folder-for-pgpass
      image: "dpage/pgadmin4:latest"
      command: ["/bin/mkdir", "-p", "/var/lib/pgadmin/storage/pgadmin"]
      volumeMounts:
        - name: pgadmin-data
          mountPath: /var/lib/pgadmin
      securityContext:
        runAsUser: 5050

keycloak:
  auth:
    adminUser: foundry
    adminPassword: foundry
  httpRelativePath: /auth/
  ingress:
    enabled: true
    hostname: foundry.local
    tls: true
    extraTls:
      - hosts:
          - foundry.local
        secretName: appliance-cert
  postgresql:
    enabled: false
  externalDatabase:
    host: foundry-postgresql
    user: postgres
    database: keycloak
    existingSecret: foundry-secret
    existingSecretPasswordKey: postgres-password

gitea:
  ingress:
    enabled: true
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /$2
    hosts:
      - host: foundry.local
        paths:
          - path: "/gitea(/|$)(.*)"
            pathType: ImplementationSpecific
    tls:
      - secretName: appliance-cert
        hosts:
          - foundry.local
  persistence:
    size: 1Gi
    storageClass: local-path
  extraVolumes:
    - name: appliance-cert-vol
      secret:
        secretName: appliance-cert
  extraContainerVolumeMounts:
    - name: appliance-cert-vol
      mountPath: /etc/ssl/certs/appliance-ca.crt
      subPath: tls.crt
      readOnly: true
  extraInitVolumeMounts:
    - name: appliance-cert-vol
      mountPath: /etc/ssl/certs/appliance-ca.crt
      subPath: tls.crt
      readOnly: true
  gitea:
    admin:
      existingSecret: foundry-gitea-admin-secret
      email: "administrator@foundry.local"
#    oauth:
#      - name: Foundry
#        provider: openidConnect
#        autoDiscoverUrl: https://foundry.local/auth/realms/master/.well-known/openid-configuration
#        existingSecret: gitea-oauth-client
    config:
      APP_NAME: Foundry Gitea
      server:
        DOMAIN: https://foundry.local/gitea/
        ROOT_URL: https://foundry.local/gitea/
        DISABLE_SSH: true
      database:
        DB_TYPE: postgres
        HOST: foundry-postgresql:5432
        NAME: gitea
        USER: postgres
        SCHEMA: public
      security:
        PASSWORD_COMPLEXITY: "off"
      repository:
        DEFAULT_BRANCH: main
      oauth2_client:
        OPENID_CONNECT_SCOPES: profile email
        ENABLE_AUTO_REGISTRATION: true
        USERNAME: userid
        ACCOUNT_LINKING: auto
    additionalConfigFromEnvs:
      - name: GITEA__DATABASE__PASSWD
        valueFrom:
          secretKeyRef:
            name: foundry-secret
            key: postgres-password
  redis-cluster:
    enabled: false
  redis:
    enabled: true
    global:
      redis:
        password: foundry
  postgresql-ha:
    enabled: false
